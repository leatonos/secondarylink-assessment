<!-- Loading/Error -->
<div *ngIf="loading">Loading...</div>
<div *ngIf="error">{{ error }}</div>

<!-- Page Size Control -->
<div *ngIf="!loading && !error" style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
  <p> Total funds: {{funds.length}}</p>
  <label for="pageSizeSelect">Rows per page:</label>
  <select id="pageSizeSelect" [value]="pageSize" (change)="onPageSizeChange($any($event.target).value)">
    <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
  </select>
</div>

<button class="create-btn" (click)="showCreator = true">
  + Create New Fund
</button>

<!-- Table -->
<table *ngIf="!loading && !error">
  <thead>
    <tr>
      <th>Name</th>
      <th>Fund Size</th>
      <th>Currency</th>
      <th>Vintage</th>
      <th>Strategies</th>
      <th>Managers</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let fund of paginatedFunds">
      <td><a href="fund/{{ fund.name }}">{{ fund.name }}</a></td>
      <td>{{ fund.fundSize }}</td>
      <td>{{ fund.currency }}</td>
      <td>{{ fund.vintage }}</td>
      <td>{{ fund.strategies.join(', ') }}</td>
      <td>{{ fund.managers.join(', ') }}</td>
      <td>
        <button class="icon-btn edit-btn" (click)="selectFundForEdit(fund)">
          <img src="imgs/edit.svg" alt="Edit" width="20" height="20">
        </button>
        <button class="icon-btn edit-btn" (click)="confirmDelete(fund)">
          <img src="imgs/delete.svg" alt="Edit" width="20" height="20">
        </button>
      </td>
    </tr>
  </tbody>
</table>

<!-- Pagination Controls -->
<div *ngIf="!loading && !error" style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
  <button (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
  <span>Page {{ currentPage }} / {{ totalPages }}</span>
  <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
</div>

<!-- Editor Modal -->
<div class="modal-backdrop" *ngIf="selectedFund" (click)="closeModal()">
   <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
         <h2>Edit Fund</h2>
         <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>
      <app-fund-editor [fund]="selectedFund" (fundUpdated)="onFundUpdated($event)"></app-fund-editor>
   </div>
</div>

<!-- Creator Modal -->
<div class="modal-backdrop" *ngIf="showCreator" (click)="showCreator = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Fund</h2>
      <button class="close-btn" (click)="showCreator = false">&times;</button>
    </div>
    
    <app-fund-creator 
      (onSave)="executeCreate($event)" 
      (onCancel)="showCreator = false">
    </app-fund-creator>
  </div>
</div>


<!-- Delete Modal -->
<div class="modal-backdrop" *ngIf="fundToDelete" (click)="cancelDelete()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-delete-confirm 
      [fundName]="fundToDelete.name" 
      (onConfirm)="executeDelete()" 
      (onCancel)="cancelDelete()">
    </app-delete-confirm>
  </div>
</div>