<!-- Loading/Error -->
<div *ngIf="loading">Loading...</div>
<div *ngIf="error">{{ error }}</div>

<!-- Page Size Control -->
<div *ngIf="!loading && !error" class="header-actions">

  <div class="controls">
    <p>Total funds: <strong>{{ funds.length }}</strong></p>

    <label for="pageSizeSelect">Rows per page:</label>
    <select id="pageSizeSelect"
            [value]="pageSize"
            (change)="onPageSizeChange($any($event.target).value)">
      <option *ngFor="let size of pageSizeOptions" [value]="size">
        {{ size }}
      </option>
    </select>
  </div>

  <button class="create-btn" (click)="showCreator = true">
    + Create New Fund
  </button>

</div>



  <div class="filters">
  <h3>Filters</h3>

  <div class="filter-group">
    <label for="searchName">Fund Name</label>
    <input 
      id="searchName"
      placeholder="Search by Name..." 
      [(ngModel)]="filterName" 
      (ngModelChange)="currentPage = 1"
    />
  </div>

  <div class="filter-group">
    <label for="filterCurrency">Currency</label>
    <input 
      id="filterCurrency"
      placeholder="e.g. USD, EUR" 
      [(ngModel)]="filterCurrency" 
    />
  </div>

  <div class="filter-group">
    <label for="filterVintage">Vintage Year</label>
    <input 
      id="filterVintage"
      type="number"
      placeholder="e.g. 2021" 
      [(ngModel)]="filterVintage" 
    />
  </div>

  <div class="filter-group">
    <label for="filterStrategy">Strategy</label>
    <input 
      id="filterStrategy"
      placeholder="e.g. Buyout" 
      [(ngModel)]="filterStrategy" 
    />
  </div>

  <div class="filter-group">
    <label for="filterManager">Manager</label>
    <input 
      id="filterManager"
      placeholder="Search Manager..." 
      [(ngModel)]="filterManager" 
    />
  </div>
</div>




<!-- Table -->
<div class="table-wrapper">
  <table *ngIf="!loading && !error">
    <thead>
      <tr>
        <th (click)="sortBy('name')" style="cursor:pointer">Name</th>
        <th (click)="sortBy('fundSize')" style="cursor:pointer">Fund Size</th>
        <th>Currency</th>
        <th>Vintage</th>
        <th>Strategies</th>
        <th>Managers</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let fund of paginatedFunds">
        <td><a href="fund/{{ fund.name }}">{{ fund.name }}</a></td>
        <td>{{ fund.fundSize }}</td>
        <td>{{ fund.currency }}</td>
        <td>{{ fund.vintage }}</td>
        <td>{{ fund.strategies.join(', ') }}</td>
        <td>{{ fund.managers.join(', ') }}</td>
        <td>
          <button class="icon-btn edit-btn" (click)="selectFundForEdit(fund)">
            <img src="imgs/edit.svg" alt="Edit" width="20" height="20">
          </button>
          <button class="icon-btn edit-btn" (click)="confirmDelete(fund)">
            <img src="imgs/delete.svg" alt="Edit" width="20" height="20">
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination Controls -->
<div *ngIf="!loading && !error" class="pagination">
  <button (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
  <span>Page {{ currentPage }} / {{ totalPages }}</span>
  <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
</div>

<!-- Editor Modal -->
<div class="modal-backdrop" *ngIf="selectedFund" (click)="closeModal()">
   <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
         <h2>Edit Fund</h2>
         <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>
      <app-fund-editor [fund]="selectedFund" (fundUpdated)="onFundUpdated($event)"></app-fund-editor>
   </div>
</div>

<!-- Creator Modal -->
<div class="modal-backdrop" *ngIf="showCreator" (click)="showCreator = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Fund</h2>
      <button class="close-btn" (click)="showCreator = false">&times;</button>
    </div>
    
    <app-fund-creator 
      (onSave)="executeCreate($event)" 
      (onCancel)="showCreator = false">
    </app-fund-creator>
  </div>
</div>


<!-- Delete Modal -->
<div class="modal-backdrop" *ngIf="fundToDelete" (click)="cancelDelete()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-delete-confirm 
      [fundName]="fundToDelete.name" 
      (onConfirm)="executeDelete()" 
      (onCancel)="cancelDelete()">
    </app-delete-confirm>
  </div>
</div>